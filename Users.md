# Autorization1S

Форма элемента справочника пользователи
```
  &НаСервере
  Процедура ПередЗаписьюНаСервере(Отказ, ТекущийОбъект, ПараметрыЗаписи)
  	//Запрос, который выбирает данные по логину	
  	Запрос = Новый Запрос;
  	Запрос.Текст = 
  	"ВЫБРАТЬ
  	|	Пользователи.Логин КАК Логин,
  	|	Пользователи.УникальныйИдентификатор КАК УникальныйИдентификатор
  	|ИЗ
  	|	Справочник.Пользователи КАК Пользователи
  	|ГДЕ
  	|	Пользователи.Логин = &Логин";
  	Запрос.УстановитьПараметр("Логин", Объект.Логин);
  	РезультатЗапроса = Запрос.Выполнить().Выбрать();
  	//Проверка наличия пользователя в базе
  	Если РезультатЗапроса.Следующий() Тогда
  		//проверка есть ли пользователь с таким логином
  		Если РезультатЗапроса.Количество()=0 ИЛИ ТекущийОбъект.УникальныйИдентификатор=РезультатЗапроса.УникальныйИдентификатор Тогда
  			//Найти пользователя с списке пользователей ИБ через УИ
  			ПользовательСсылка=ПользователиИнформационнойБазы.НайтиПоУникальномуИдентификатору(ТекущийОбъект.УникальныйИдентификатор);
  			//Если пользователь не найден, то создаем нового
  			Если ПользовательСсылка=Неопределено Тогда
  				//создаем пользователя ИБ
  				НовыйПользователь=ПользователиИнформационнойБазы.СоздатьПользователя();
  				НовыйПользователь.Имя=Объект.Логин;
  				СоздатьИзменитьПользователя(НовыйПользователь);
  				ТекущийОбъект.УникальныйИдентификатор=НовыйПользователь.УникальныйИдентификатор;
  			Иначе
  				//у найденного пользователя изменить все данные, кроме логина
  				СоздатьИзменитьПользователя(ПользовательСсылка);
  			КонецЕсли;
  		Иначе
  			//Вывод сообщения
  			Сообщение=Новый СообщениеПользователю;
  			Сообщение.Текст="Пользователь с таким логином уже существует";
  			Сообщение.Сообщить();
  			Отказ=Истина;
  		КонецЕсли;
  	Иначе
  		//создаем пользователя ИБ
  		НовыйПользователь=ПользователиИнформационнойБазы.СоздатьПользователя();
  		НовыйПользователь.Имя=Объект.Логин;
  		СоздатьИзменитьПользователя(НовыйПользователь);
  		ТекущийОбъект.УникальныйИдентификатор=НовыйПользователь.УникальныйИдентификатор;
  	КонецЕсли;
  КонецПроцедуры    
  
  
  &НаСервере  
  //Для добавления или изменения данных о пользователе
  Процедура СоздатьИзменитьПользователя(Пользователь)
  	Пользователь.Пароль=Объект.Пароль;
  	Пользователь.ПолноеИмя=Объект.Наименование;
  	Если Объект.Роль= Перечисления.Роли.СотрудникОтдела тогда
  		Пользователь.Роли.Добавить(Метаданные.Роли.СотрудникОтдела);
  	ИначеЕсли Объект.Роль= Перечисления.Роли.ФинансовыйДиректор тогда
  		Пользователь.Роли.Добавить(Метаданные.Роли.ФинансовыйДиректор);
  	ИначеЕсли Объект.Роль= Перечисления.Роли.Администратор тогда
  		Пользователь.Роли.Добавить(Метаданные.Роли.Администратор);
  	КонецЕсли;
  	Пользователь.ПоказыватьВСпискеВыбора=Истина;
  	Пользователь.Записать();
  КонецПроцедуры
```



